<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ê²€ í‚¤ìš°ê¸°</title>

<style>
body { background:#111; color:white; text-align:center; font-family:Arial; }
button { padding:15px 30px; font-size:18px; margin:10px; }

#upgradeInfo {
  margin:15px auto;
  padding:10px;
  border:1px solid #444;
  max-width:360px;
  background:#000;
  font-size:14px;
}

#toastLog {
  position:fixed;
  bottom:10px;
  left:50%;
  transform:translateX(-50%);
  width:90%;
  max-width:600px;
  background:rgba(0,0,0,0.75);
  padding:8px;
}

.toast-item { padding:4px; border-bottom:1px solid #333 }
.toast-destroy { color:red; font-weight:bold }
</style>
</head>

<body>

<div id="loginScreen">
  <h2>ğŸ” ë¡œê·¸ì¸</h2>
  <input id="loginId" placeholder="ì•„ì´ë””"><br><br>
  <input id="loginPw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸"><br><br>
  <button onclick="login()">ì ‘ì†</button>
</div>

<div id="gameScreen" style="display:none;">
  <h1>âš”ï¸ ê²€ í‚¤ìš°ê¸°</h1>
  <p id="status"></p>
  <div id="upgradeInfo"></div>

  <button onclick="upgrade()">ğŸ”¨ ê°•í™”</button>
  <button onclick="hunt()">âš”ï¸ ì‚¬ëƒ¥</button>
</div>

<div id="toastLog"><div id="toastList"></div></div>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyC-KjkMnJzN-fOBgg4P4sUo4U_VyhJTOn0",
  databaseURL:"https://sword-game-1d1a1-default-rtdb.firebaseio.com"
});

const db = firebase.database();
const logRef = db.ref("logs");

let sword=1, power=10, gold=100;
let userId="", userRef=null;

/* í™•ë¥  */
function getUpgradeChance(lv){
  if(lv<10) return {success:80, keep:20, down:0, destroy:0};
  if(lv<20) return {success:40, keep:30, down:30, destroy:0};
  if(lv<25) return {success:20, keep:0, down:40, destroy:40};
  if(lv<30) return {success:5, keep:0, down:40, destroy:55};
  return null;
}

/* UI */
function update(){
  status.innerHTML = `
    ğŸ”° ê°•í™” : +${sword}ê°•<br>
    âš”ï¸ ê³µê²©ë ¥ : ${power}<br>
    ğŸ’° ê³¨ë“œ : ${gold}
  `;
  renderUpgradeInfo();
}

function renderUpgradeInfo(){
  const c = getUpgradeChance(sword);
  if(!c){
    upgradeInfo.innerHTML = "ìµœëŒ€ ê°•í™” ë‹¨ê³„ì…ë‹ˆë‹¤.";
    return;
  }
  upgradeInfo.innerHTML = `
    <b>ê°•í™” ì •ë³´</b><br>
    ì„±ê³µ : ${c.success}%<br>
    ìœ ì§€ : ${c.keep}%<br>
    ê°•ë“± : ${c.down}%<br>
    ${c.destroy ? `<span style="color:red">íŒŒê´´ : ${c.destroy}%</span><br>` : ""}
    í•„ìš” ê³¨ë“œ : 20
  `;
}

/* ê°•í™” */
function upgrade(){
  if(!userRef || gold<20 || sword>=30) return;
  gold -= 20;

  const c = getUpgradeChance(sword);
  const r = Math.random()*100;
  const before = sword;

  if(r < c.success){
    sword++; power+=5;
    writeLog(`${userId} +${before} â†’ +${sword} ì„±ê³µ`);
  }
  else if(r < c.success + c.keep){}
  else if(r < c.success + c.keep + c.down){
    sword--; power-=5;
  }
  else{
    sword=1; power=10;
    writeLog(`${userId} +${before} íŒŒê´´`, true);
  }

  update();
  save();
}

function hunt(){
  if(!userRef) return;
  gold += Math.floor(Math.random()*power);
  update();
  save();
}

/* ë¡œê·¸ì¸ */
function login(){
  userId = loginId.value.trim();
  const pw = loginPw.value;
  if(!userId || !pw) return;

  userRef = db.ref("users/"+userId);
  userRef.once("value").then(s=>{
    if(!s.exists()){
      userRef.set({password:pw,sword,power,gold});
    } else {
      const d = s.va
