<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ê²€ í‚¤ìš°ê¸°</title>

<style>
body {
  background:#111;
  color:white;
  text-align:center;
  font-family:Arial;
}

  /* ğŸ« ì¶œì„ ë²„íŠ¼ */
#attendanceBtn {
  position:fixed;
  top:10px;
  left:10px;
  z-index:1100;
  display:none;          /* ë¡œê·¸ì¸ í›„ JSë¡œ ë³´ì´ê²Œ */
  font-size:14px;
  padding:8px 16px;
}

/* ë²„íŠ¼ */
button {
  padding:15px 30px;
  font-size:18px;
  margin:10px;
}

/* ğŸŒˆ 30ê°• ë¬´ì§€ê°œ */
.rainbow {
  background:linear-gradient(90deg,red,orange,yellow,green,cyan,blue,violet);
  background-size:400% 400%;
  -webkit-background-clip:text;
  color:transparent;
  animation:rainbow 2s linear infinite;
  display:inline-block;
}
@keyframes rainbow {
  from {background-position:0%}
  to {background-position:100%}
}
  /* âœ¨ ì‹¤ë²„ / ê³¨ë“œ ë°˜ì§ì„ */
.sparkle-silver {
  color: #C0C0C0;
  font-weight: bold;
  text-shadow: 0 0 5px rgba(192,192,192,0.8);
  animation: sparkle 1.5s infinite alternate;
}

.sparkle-gold {
  color: #FFD700;
  font-weight: bold;
  text-shadow: 0 0 8px rgba(255,215,0,0.9);
  animation: sparkle 1.2s infinite alternate;
}

/* âœ¨ ê³µí†µ ë°˜ì§ ì• ë‹ˆë©”ì´ì…˜ */
@keyframes sparkle {
  from {
    opacity: 0.85;
    filter: brightness(1);
  }
  to {
    opacity: 1;
    filter: brightness(1.4);
  }
}


/* ğŸ”” í† ìŠ¤íŠ¸ */
#toastLog {
  position:fixed;
  bottom:10px;
  left:50%;
  transform:translateX(-50%);
  width:90%;
  max-width:600px;
  background:rgba(0,0,0,0.75);
  border:1px solid #444;
  padding:8px;
  font-size:14px;
  z-index:1000;
}
.toast-item {
  padding:4px 0;
  border-bottom:1px solid #333;
}
.toast-destroy {
  color:red;
  font-weight:bold;
}

/* ë¡œê·¸ */
#logToggle {
  position:fixed;
  bottom:80px;
  right:10px;
  z-index:1001;
}
#logPanel {
  position:fixed;
  top:60px;
  right:10px;
  width:90%;
  max-width:400px;
  height:60%;
  background:rgba(0,0,0,0.9);
  border:1px solid #555;
  padding:10px;
  overflow-y:auto;
  z-index:1002;
  display:none;
}
</style>
</head>

<body>

<!-- ğŸ” ë¡œê·¸ì¸ -->
<div id="loginScreen">
  <h2>ğŸ” ë¡œê·¸ì¸</h2>
  <input id="loginId" placeholder="ì•„ì´ë””"><br><br>
  <input id="loginPw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸"><br><br>
  <button onclick="login()">ì ‘ì†</button>
</div>

<!-- ğŸ® ê²Œì„ -->
<div id="gameScreen" style="display:none;">
  <h1>âš”ï¸ ê²€ í‚¤ìš°ê¸°</h1>
<p id="status"></p>

<p id="upgradeInfo"
   style="font-size:14px; margin-top:4px; margin-bottom:8px; color:#ccc;">
</p>

<button onclick="upgrade()">ğŸ”¨ ê°•í™”</button>
<button onclick="hunt()">âš”ï¸ ì‚¬ëƒ¥</button>
<button onclick="sell()">ğŸ’° íŒë§¤</button>

  <hr>
  <h2>ğŸ† ë­í‚¹ TOP 10</h2>
  <div id="ranking">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  <div id="myRank" style="margin-top:8px; font-size:14px; color:#ccc;"></div>
</div>

<button id="attendanceBtn" onclick="checkAttendance()">ì¶œì„</button>

  
<!-- ğŸ”” ë¡œê·¸ -->
<div id="toastLog"><div id="toastList"></div></div>
<button id="logToggle" onclick="toggleLog()">ğŸ“œ ë¡œê·¸</button>
<div id="logPanel">
  <h3>ğŸ“¢ ê°•í™” ë¡œê·¸</h3>
  <div id="logPanelList"></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

<script>
/* Firebase */
firebase.initializeApp({
  apiKey:"AIzaSyC-KjkMnJzN-fOBgg4P4sUo4U_VyhJTOn0",
  authDomain:"sword-game-1d1a1.firebaseapp.com",
  databaseURL:"https://sword-game-1d1a1-default-rtdb.firebaseio.com",
  projectId:"sword-game-1d1a1"
});
const db = firebase.database();
const logRef = db.ref("logs");

/* ìƒíƒœ */
let sword = 0, power = 10, gold = 100;
let userId="", userPassword="", userRef=null;
  let attendanceCount = 0;
let lastAttendanceDate = "";


/* UI */
function update(){

  // ê¸°ì¡´ ìƒíƒœ í‘œì‹œ
  document.getElementById("status").innerHTML = `
    <div style="font-size:18px;">
      ğŸ”° í˜„ì¬ ê°•í™” : <b>+${sword}ê°•</b><br>
      âš”ï¸ ê³µê²©ë ¥ : <b>${power}</b><br>
      ğŸ’° ê³¨ë“œ : <b>${formatGold(gold)}</b>
    </div>
  `;

  // ì„±ê³µ í™•ë¥ 
  const success = getUpgradeChance(sword);

  let failInfo = "";
  let failRemain = 100 - success; // ì‹¤íŒ¨ ì´ ë¹„ìœ¨

  // -----------------------------
  // â­ ë‹¨ê³„ êµ¬ê°„ë³„ í™•ë¥  í‘œì‹œ ê·œì¹™
  // -----------------------------

  if (sword <= 10) {

    failInfo = `
      ì‹¤íŒ¨: <b>${failRemain}%</b> (ìœ ì§€)
    `;

  } else if (sword <= 20) {

    const keep = Math.round(failRemain * 0.5);
    const down = failRemain - keep;

    failInfo = `
      ì‹¤íŒ¨: <b>${failRemain}%</b>
      â€” ìœ ì§€ <b>${keep}%</b> / ê°•ë“± <b>${down}%</b>
    `;

  } else {

    const down = Math.round(failRemain * 0.4);
    const destroy = failRemain - down;

    failInfo = `
      ì‹¤íŒ¨: <b>${failRemain}%</b>
      â€” ê°•ë“± <b>${down}%</b> / íŒŒê´´ <span style="color:red;font-weight:bold;">${destroy}%</span>
    `;
  }

  // ğŸ”¸ ê°•í™” ë¹„ìš© ê³„ì‚°
  const cost = getUpgradeCost(sword);


  
  // â­ 5ì˜ ë°°ìˆ˜ ë ˆë²¨ ì„¸ì´í”„ ì•ˆë‚´
  let safeNote = "";
  if (sword % 5 === 0 && sword !== 0) { // 5,10,15,... ì—ì„œë§Œ í‘œì‹œí•˜ê³  ì‹¶ìœ¼ë©´ ì´ë ‡ê²Œ
    safeNote = `<br><span style="color:#6cf;">
      â€» ì„¸ì´í”„ êµ¬ê°„: ì‹¤íŒ¨í•´ë„ ê°•ë“±/íŒŒê´´ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    </span>`;
  }

  // -----------------------------
  // UI ì¶œë ¥
  // -----------------------------
document.getElementById("upgradeInfo").innerHTML = `
  ì„±ê³µ <b>${success}%</b> / ${failInfo}
  <br>í•„ìš” ê³¨ë“œ <b>${formatGold(cost)}</b>
  ${safeNote}
`;

}

  // ìˆ«ì ê³¨ë“œë¥¼ "12ì–µ 8,765ë§Œ 4,252" í˜•íƒœë¡œ ë³€í™˜
function formatGold(value) {
  const n = Number(value) || 0;

  // 100ë§Œ ë¯¸ë§Œì€ ê·¸ëƒ¥ ìˆ«ì+ì½¤ë§ˆë¡œ
  if (n < 1_000_000) {
    return n.toLocaleString();
  }

  const EOK = 100_000_000; // ì–µ
  const MAN = 10_000;      // ë§Œ

  const eok = Math.floor(n / EOK);
  let rest = n % EOK;
  const man = Math.floor(rest / MAN);
  const won = rest % MAN;

  const parts = [];
  if (eok > 0) parts.push(`${eok.toLocaleString()}ì–µ`);
  if (man > 0) parts.push(`${man.toLocaleString()}ë§Œ`);
  if (won > 0) parts.push(won.toLocaleString());

  if (parts.length === 0) return "0";
  return parts.join(" ");
}

  
function getUpgradeCost(level) {

  const costTable = {
    0: 0,
    1: 20,
    2: 50,
    3: 100,
    4: 500,
    5: 1000,
    6: 3000,
    7: 5000,
    8: 10000,
    9: 30000,
    10: 50000,
    11: 100000,
    12: 300000,
    13: 500000,
    14: 1000000,
    15: 3000000,
    16: 5000000,
    17: 10000000,
    18: 30000000,
    19: 50000000,
    20: 100000000,
    21: 300000000,
    22: 500000000,
    23: 1000000000,
    24: 3000000000,
    25: 5000000000,
    26: 10000000000,
    27: 30000000000,
    28: 50000000000,
    29: 100000000000
  };

  return costTable[level] ?? 0;
}

// íŒë§¤ ì‹œ, ê·¸ ë ˆë²¨ì—ì„œ ë‹¤ìŒ ê°•í™”ë¥¼ ëª‡ ë²ˆ ì •ë„ ë„ì „ ê°€ëŠ¥í•˜ê²Œ í•´ì¤„ì§€ ê²°ì •
function getSellAttemptFactor(level) {
  // 30ê°•ì€ 29ê°• ê¸°ì¤€ìœ¼ë¡œ ë³¸ë‹¤ (ë¹„ìš©/í™•ë¥  í…Œì´ë¸”ì´ 29ê¹Œì§€ë¼ì„œ)
  const forChance = Math.min(level, 29);

  const chance = getUpgradeChance(forChance); // 0~100
  if (chance <= 0) return 2; // ì•ˆì „ ì¥ì¹˜

  const expectedTries = 100 / chance; // ì„±ê³µê¹Œì§€ í‰ê·  ì‹œë„ íšŸìˆ˜

  if (expectedTries <= 2.0) {
    return 2;   // ì„±ê³µë¥  ë†’ìŒ â†’ 2ë²ˆ ì •ë„ ë„ì „ê¶Œ
  } else if (expectedTries <= 3.5) {
    return 3;
  } else if (expectedTries <= 4.5) {
    return 4;
  } else if (expectedTries <= 7.0) {
    return 5;   // ì˜ˆ: 20%~25%ëŒ€ í™•ë¥ 
  } else {
    return 6;   // ì•„ì£¼ ë‚®ì€ í™•ë¥  â†’ 5~6ë²ˆ ë„ì „ê¶Œ
  }
}

// Lê°• ì¥ë¹„ íŒë§¤ ì‹œ ë°›ì„ ê³¨ë“œ ê³„ì‚°
// A = 0â†’Lê¹Œì§€ ì„±ê³µ ê°€ì • ì´ë¹„ìš©
// B = Lê°• ê°•í™”ë¹„ìš© Ã— (ê¸°ëŒ“ê°’ ê¸°ë°˜ ë„ì „ íšŸìˆ˜)
// ë³´ìƒ = (A + B) Ã— 1.15~1.20
function getSellReward(level) {
  if (level <= 0) return 0; // 0ê°•ì€ íŒ” ê²Œ ì—†ìŒ

  const totalCost = getTotalCostToLevel(level);   // A
  const costNow   = getUpgradeCost(Math.min(level, 29)); // Lê°• ì‹œë„ ë¹„ìš© (30ê°• ë³´í˜¸)

  const attemptFactor = getSellAttemptFactor(level); // ë„ì „ íšŸìˆ˜ ë³´ì •
  const B = costNow * attemptFactor;

  const base = totalCost + B;
  const mul  = randRange(1.15, 1.20); // 115% ~ 120%

  const reward = Math.floor(base * mul);
  return reward;
}

  
// 0ê°• â†’ levelê°• ê¹Œì§€, ëª¨ë‘ 1íŠ¸ ì„±ê³µí•œë‹¤ê³  ê°€ì •í•œ ì´ ê°•í™”ë¹„ìš©
function getTotalCostToLevel(level) {
  let sum = 0;
  for (let i = 0; i < level; i++) {
    sum += getUpgradeCost(i);
  }
  return sum;
}

// min ~ max ì‚¬ì´ ëœë¤ ì‹¤ìˆ˜
function randRange(min, max) {
  return min + Math.random() * (max - min);
}

  
/* í™•ë¥  */
function getUpgradeChance(level) {
  // 0 -> 1 ì€ 100% ê³ ì •
  if (level === 0) return 100;

  let chance;

  if (level < 20) {
    // 1 ~ 19ê°• êµ¬ê°„ : ë ˆë²¨ 1 ì˜¤ë¥¼ ë•Œë§ˆë‹¤ -4%
    // ì˜ˆ) 1ê°• -> 2ê°•: 96%, 10ê°• -> 11ê°•: 60%
    chance = 100 - (level * 4);
  } else {
    // 20ê°• ì´í›„ : -2%ì”© ê°ì†Œ
    // 20ê°• ê¸°ì¤€ê°’ = 100 - 20*4 = 20%
    const base20 = 100 - (20 * 4); // 20%
    const extra = level - 20;
    chance = base20 - (extra * 2);
  }

  // ìµœì†Œ 5% ë³´ì¥
  return Math.max(5, chance);
}


function checkAttendance() {
  if (!userRef || !userId) {
    alert("ë¡œê·¸ì¸ í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.");
    return;
  }

  const today = getTodayDateString();

  // ì´ë¯¸ ì˜¤ëŠ˜ ì¶œì„ í–ˆëŠ”ì§€ ì²´í¬
  if (lastAttendanceDate === today) {
    alert("ì˜¤ëŠ˜ì€ ì´ë¯¸ ì¶œì„í•˜ì…¨ìŠµë‹ˆë‹¤!");
    return;
  }

  // ì¶œì„ ì²˜ë¦¬
  lastAttendanceDate = today;
  attendanceCount = (attendanceCount || 0) + 1;

  const reward = 60000;
  gold += reward;

  alert(`ì¶œì„ ì™„ë£Œ! ê³¨ë“œ +${formatGold(reward)}`);

  // ì¶œì„ ë¡œê·¸ ë‚¨ê¸°ê¸°
  writeLog(`${userId}ë‹˜ì´ ì¶œì„í–ˆìŠµë‹ˆë‹¤. (${attendanceCount}íšŒì°¨)`);

  update();
  save();
}

  
/* ê°•í™” */
function upgrade(){
  if(sword>=30){alert("ìµœëŒ€ ê°•í™”");return;}
const cost = getUpgradeCost(sword);

if (gold < cost) {
  alert(`ê³¨ë“œ ë¶€ì¡±! (í•„ìš”: ${formatGold(cost)} G)`);
  return;
}


gold -= cost;


  const chance=getUpgradeChance(sword);
  const before=sword;

  if(Math.random()<chance/100){
    // âœ… ì„±ê³µ
    sword++; power+=5;
    alert("ê°•í™” ì„±ê³µ!");
    if(before>=20){
      writeLog(`${userId}ì´ ${coloredLevel(before)} ë„ì „ì— ì„±ê³µí•˜ì—¬ ${coloredLevel(sword)}ì´ ë˜ì—ˆìŠµë‹ˆë‹¤!`);
    }
  }else{
    // âŒ ì‹¤íŒ¨
    const isSafeLevel = (before % 5 === 0); // 5,10,15,20,25,30 ì„¸ì´í”„

    if (isSafeLevel) {
      // ì„¸ì´í”„ êµ¬ê°„: ì‹¤íŒ¨í•´ë„ ê°•ë“±/íŒŒê´´ ì—†ìŒ
      alert("ì‹¤íŒ¨ (ì„¸ì´í”„ êµ¬ê°„ ìœ ì§€)");
      // sword, power ë³€í™” ì—†ìŒ
    } else {
      // ğŸ”» ê¸°ì¡´ í˜ë„í‹° ë¡œì§ ìœ ì§€
      if(sword<=10){
        alert("ì‹¤íŒ¨ (ìœ ì§€)");
      }else if(sword<=20){
        if(Math.random()<0.5) {
          alert("ì‹¤íŒ¨ (ìœ ì§€)");
        } else {
          sword--; power-=5; alert("ê°•ë“±");
        }
      }else{
        if(Math.random()<0.4){
          sword--; power-=5; alert("ê°•ë“±");
        }else{
          sword=0; power=10;
          writeLog(`${userId}ì´ ${coloredLevel(before)} ë„ì „ì— ì‹¤íŒ¨í•˜ì—¬ <span style="color:red;font-weight:bold;">íŒŒê´´</span> ë˜ì—ˆìŠµë‹ˆë‹¤!`,true);
          alert("íŒŒê´´");
        }
      }
    }
  }
  update(); save();
}

function sell() {
  if (!userRef || !userId) {
    alert("ë¡œê·¸ì¸ í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.");
    return;
  }

  if (sword <= 0) {
    alert("íŒë§¤í•  ì¥ë¹„ê°€ ì—†ìŠµë‹ˆë‹¤.");
    return;
  }

  const before = sword;
  const reward = getSellReward(before);

  gold += reward;
  sword = 0;
  power = 10;

  alert(`+${before}ê°• ì¥ë¹„ë¥¼ íŒë§¤í•˜ì—¬ ${formatGold(reward)} ê³¨ë“œë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤!`);

  writeLog(
    `${userId}ë‹˜ì´ ${coloredLevel(before)} ì¥ë¹„ë¥¼ íŒë§¤í•˜ì—¬ ${formatGold(reward)} ê³¨ë“œë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤!`
  );

  update();
  save();
}

  
/* ì‚¬ëƒ¥ */
function hunt(){
const earn = Math.floor(Math.random()*power);
gold += earn;
alert(`ê³¨ë“œ +${formatGold(earn)}`);
  update(); save();
}

/* ë¡œê·¸ì¸ */
function login(){
  userId = loginId.value.trim();
  userPassword = loginPw.value;
  if (!userId || !userPassword) {
    alert("ì…ë ¥ í•„ìš”");
    return;
  }

  userRef = db.ref("users/" + userId);

  userRef.once("value").then(s => {

    // â­ ì‹ ê·œ ê³„ì • ìƒì„± ì‹œ
    if (!s.exists()) {

      userRef.set({
        password: userPassword,
        sword,
        power,
        gold,
        updated: Date.now(),
        attendanceCount: 0,
        lastAttendanceDate: ""
      });

    } 
    // â­ ê¸°ì¡´ ê³„ì • ë¡œê·¸ì¸ ì‹œ
    else {

      if (s.val().password !== userPassword) {
        alert("ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜");
        return;
      }

      const data = s.val();

      sword = data.sword ?? 0;
      power = data.power ?? 10;
      gold  = data.gold  ?? 100;

      attendanceCount    = data.attendanceCount    ?? 0;
      lastAttendanceDate = data.lastAttendanceDate ?? "";
    }

    // í™”ë©´ ì „í™˜ + ì¶œì„ ë²„íŠ¼ í‘œì‹œ
    loginScreen.style.display  = "none";
    gameScreen.style.display   = "block";
    document.getElementById("attendanceBtn").style.display = "block";

    update();
  });
}

function save() {
  if (!userRef) return;
  userRef.update({
    sword: Number(sword),
    power: Number(power),
    gold: Number(gold),
    updated: Date.now(),
    attendanceCount: attendanceCount,
    lastAttendanceDate: lastAttendanceDate
  });
}


/* ìƒ‰ìƒ */
function getSwordColor(l){
  if (l >= 30) return "rainbow";
  if (l === 29) return "sparkle-gold";
  if (l === 28) return "sparkle-silver";

  const colorMap = {
    21: "red",
    22: "yellow",
    23: "lime",
    24: "cyan",
    25: "violet",
    26: "brown",
    27: "pink"
  };

  if (l >= 21) return colorMap[l] || "white";
  if (l >= 11) return "lime";
  return "white";
}

function coloredLevel(l){
  // ğŸŒˆ 30ê°•
  if (l >= 30) {
    return `<span class="rainbow">+${l}ê°•</span>`;
  }

  // âœ¨ 29 / 28 ë°˜ì§
  if (l === 29) {
    return `<span class="sparkle-gold">+${l}ê°•</span>`;
  }
  if (l === 28) {
    return `<span class="sparkle-silver">+${l}ê°•</span>`;
  }

  // ğŸ¨ 21~27 ê°œë³„ ìƒ‰ìƒ
  const colorMap = {
    21: "red",
    22: "yellow",
    23: "lime",
    24: "cyan",
    25: "violet",
    26: "brown",
    27: "pink"
  };

  if (l >= 21) {
    return `<span style="color:${colorMap[l]};font-weight:bold;">+${l}ê°•</span>`;
  }

  // ğŸ‘‰ 11~20ì€ ìƒ‰ ì—†ìŒ (ê¸°ë³¸ í°ìƒ‰)
  return `+${l}ê°•`;
}



/* ë­í‚¹ */
function loadRanking(){
  const usersRef = db.ref("users");

  // ğŸ” TOP 10 í‘œì‹œ
  usersRef
    .orderByChild("sword")
    .limitToLast(10)
    .on("value", s=>{
      let arr=[];
      s.forEach(c=>{
        const d=c.val();
        arr.push({
          id: c.key,
          sword: Number(d.sword || 0),
          gold:  Number(d.gold  || 0),
          updated: Number(d.updated || 0)
        });
      });

      // sword -> updated ìˆœìœ¼ë¡œ ì •ë ¬
      arr.sort((a, b) => {
        if (b.sword !== a.sword) return b.sword - a.sword;
        return a.updated - b.updated;
      });

ranking.innerHTML = arr.map((u,i)=>`
  <div style="font-weight:bold;">
    ${i+1}. ${u.id} | ${coloredLevel(u.sword)} | ğŸ’° ${formatGold(u.gold)}
  </div>
`).join("");

    });

  // ğŸ‘‡ ë‚´ ë­í‚¹ ê³„ì‚°
  usersRef
    .orderByChild("sword")
    .on("value", s=>{
      // ì•„ì§ ë¡œê·¸ì¸ ì•ˆ í–ˆìœ¼ë©´ í‘œì‹œ ì•ˆ í•¨
      if (!userId) {
        myRank.innerText = "";
        return;
      }

      let arr = [];
      s.forEach(c => {
        const d = c.val();
        arr.push({
          id: c.key,
          sword: Number(d.sword || 0),
          gold:  Number(d.gold  || 0),
          updated: Number(d.updated || 0)
        });
      });

      // ì „ì²´ ìœ ì €ë¥¼ ë™ì¼ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬
      arr.sort((a, b) => {
        if (b.sword !== a.sword) return b.sword - a.sword;
        return a.updated - b.updated;
      });

      const idx = arr.findIndex(u => u.id === userId);

      if (idx === -1) {
        myRank.innerText = "ë‚´ ë­í‚¹: ê¸°ë¡ ì—†ìŒ";
      } else {
        const myInfo = arr[idx];
myRank.innerHTML = `
  ë‚´ ë­í‚¹: <b>${idx + 1}ìœ„</b> 
  (${coloredLevel(myInfo.sword)}, ğŸ’° ${formatGold(myInfo.gold)})
`;

      }
    });
}

// ì˜¤ëŠ˜ ë‚ ì§œë¥¼ "YYYY-MM-DD" í˜•íƒœë¡œ ë°˜í™˜ (ì¶œì„ ì²´í¬ìš©)
function getTodayDateString() {
  const d = new Date();
  const y = d.getFullYear();
  const m = String(d.getMonth() + 1).padStart(2, "0");
  const day = String(d.getDate()).padStart(2, "0");
  return `${y}-${m}-${day}`;
}

  
function formatTime(ts) {
  const d = new Date(ts);

  const mm = String(d.getMonth() + 1).padStart(2, "0"); // ì›”
  const dd = String(d.getDate()).padStart(2, "0");      // ì¼
  const min = String(d.getMinutes()).padStart(2, "0");  // ë¶„
  const sec = String(d.getSeconds()).padStart(2, "0");  // ì´ˆ

  return `${mm}/${dd} ${min}:${sec}`;
}


/* ë¡œê·¸ */
function writeLog(message,isDestroy=false){
  logRef.push({message,isDestroy,time:Date.now()});
}
logRef.limitToLast(50).on("child_added",s=>{
  const d=s.val();

  const ts = formatTime(d.time); // â± íƒ€ì„ìŠ¤íƒ¬í”„ ë³€í™˜

  const el=document.createElement("div");
  el.className="toast-item"+(d.isDestroy?" toast-destroy":"");

el.innerHTML = `<span style="color:#888;">[${ts}]</span> ${d.message}`;


  toastList.prepend(el);
  while(toastList.children.length>5) toastList.lastChild.remove();

  const p=el.cloneNode(true);
  logPanelList.prepend(p);
});

/* ë¡œê·¸ í† ê¸€ */
function toggleLog(){
  logPanel.style.display = logPanel.style.display==="none"?"block":"none";
}
  
  loadRanking();
</script>

</body>
</html>
