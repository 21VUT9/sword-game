<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ê²€ í‚¤ìš°ê¸°</title>

<style>
body {
  background:#111;
  color:white;
  text-align:center;
  font-family:Arial;
}

button {
  padding:15px 30px;
  font-size:18px;
  margin:10px;
}

/* ğŸŒˆ 30ê°• ë¬´ì§€ê°œ */
.rainbow {
  background: linear-gradient(90deg, red, orange, yellow, green, cyan, blue, violet);
  background-size:400% 400%;
  -webkit-background-clip:text;
  color:transparent;
  animation:rainbow 2s linear infinite;
  display:inline-block;
}
@keyframes rainbow {
  from { background-position:0% }
  to   { background-position:100% }
}

/* ğŸ”” í•˜ë‹¨ ë¡œê·¸ */
#toastLog {
  position:fixed;
  bottom:10px;
  left:50%;
  transform:translateX(-50%);
  width:90%;
  max-width:600px;
  background:rgba(0,0,0,0.75);
  border:1px solid #444;
  padding:8px;
  font-size:14px;
  z-index:1000;
}
.toast-item {
  padding:4px 0;
  border-bottom:1px solid #333;
}
.toast-destroy {
  color:red;
  font-weight:bold;
}

/* ğŸ“œ ë¡œê·¸ íŒ¨ë„ */
#logToggle {
  position:fixed;
  bottom:80px;
  right:10px;
}
#logPanel {
  position:fixed;
  top:60px;
  right:10px;
  width:90%;
  max-width:400px;
  height:60%;
  background:rgba(0,0,0,0.9);
  border:1px solid #555;
  padding:10px;
  overflow-y:auto;
  display:none;
}
</style>
</head>

<body>

<!-- ğŸ” ë¡œê·¸ì¸ -->
<div id="loginScreen">
  <h2>ğŸ” ë¡œê·¸ì¸</h2>
  <input id="loginId" placeholder="ì•„ì´ë””"><br><br>
  <input id="loginPw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸"><br><br>
  <button onclick="login()">ì ‘ì†</button>
</div>

<!-- ğŸ® ê²Œì„ -->
<div id="gameScreen" style="display:none;">
  <h1>âš”ï¸ ê²€ í‚¤ìš°ê¸°</h1>
  <p id="status"></p>

  <hr>
  <h2>ğŸ† ë­í‚¹ TOP 10</h2>
  <div id="ranking">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>

  <button onclick="upgrade()">ğŸ”¨ ê°•í™”</button>
  <button onclick="hunt()">âš”ï¸ ì‚¬ëƒ¥</button>
</div>

<!-- ğŸ”” ë¡œê·¸ -->
<div id="toastLog"><div id="toastList"></div></div>
<button id="logToggle" onclick="toggleLog()">ğŸ“œ ë¡œê·¸</button>
<div id="logPanel"><h3>ğŸ“¢ ê°•í™” ë¡œê·¸</h3><div id="logPanelList"></div></div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

<script>
/* ===============================
   ğŸ”¥ Firebase ì´ˆê¸°í™”
================================ */
firebase.initializeApp({
  apiKey: "AIzaSyC-KjkMnJzN-fOBgg4P4sUo4U_VyhJTOn0",
  authDomain: "sword-game-1d1a1.firebaseapp.com",
  databaseURL: "https://sword-game-1d1a1-default-rtdb.firebaseio.com",
  projectId: "sword-game-1d1a1",
});
const db = firebase.database();
const logRef = db.ref("logs");

/* ===============================
   ğŸ”‘ ì „ì—­ ìƒíƒœ
================================ */
let sword = 1, power = 10, gold = 100;
let userId = "", userPassword = "", userRef = null;

/* ===============================
   ğŸ“Š í™•ë¥  & ìƒ‰ìƒ
================================ */
function getUpgradeChance(lv){
  if(lv < 10) return 80;
  if(lv < 20) return 40;
  if(lv < 25) return 20;
  if(lv < 30) return 5;
  return 0;
}

function getSwordColor(lv){
  if(lv >= 30) return "rainbow";
  const map = {
    29:"gold",28:"silver",27:"hotpink",26:"brown",
    25:"purple",24:"dodgerblue",23:"limegreen",
    22:"yellow",21:"red"
  };
  return map[lv] || "white";
}

function coloredLevel(lv){
  if(lv >= 30) return `<span class="rainbow">+${lv}ê°•</span>`;
  return `<span style="color:${getSwordColor(lv)};font-weight:bold">+${lv}ê°•</span>`;
}

/* ===============================
   ğŸ® UI
================================ */
function update(){
  status.innerHTML = `
    ğŸ”° í˜„ì¬ ê°•í™” : <b>+${sword}ê°•</b><br>
    âš”ï¸ ê³µê²©ë ¥ : <b>${power}</b><br>
    ğŸ’° ê³¨ë“œ : <b>${gold}</b>
  `;
}

/* ===============================
   ğŸ”¨ ê°•í™” / ì‚¬ëƒ¥
================================ */
function upgrade(){
  if(!userRef) return alert("ë¡œê·¸ì¸ í•„ìš”");
  if(sword>=30) return alert("ìµœëŒ€ ê°•í™”");
  if(gold<20) return alert("ê³¨ë“œ ë¶€ì¡±");

  gold -= 20;
  const chance = getUpgradeChance(sword);
  const before = sword;

  if(Math.random() < chance/100){
    sword++; power+=5;
    if(before>=20)
      writeLog(`${userId}ì´ ${coloredLevel(before)} â†’ ${coloredLevel(sword)} ì„±ê³µ`);
  } else {
    if(sword<=20){
      if(Math.random()>0.5){ sword--; power-=5; }
    } else {
      if(Math.random()>0.6){ sword--; power-=5; }
      else {
        sword=1; power=10;
        writeLog(`${userId}ì´ ${coloredLevel(before)} ë„ì „ ì‹¤íŒ¨ <span style="color:red">íŒŒê´´</span>`, true);
      }
    }
  }
  update(); save();
}

function hunt(){
  if(!userRef) return alert("ë¡œê·¸ì¸ í•„ìš”");
  const earn = Math.floor(Math.random()*power);
  gold += earn;
  update(); save();
}

/* ===============================
   ğŸ” ë¡œê·¸ì¸ / ì €ì¥
================================ */
function login(){
  userId = loginId.value.trim();
  userPassword = loginPw.value;
  if(!userId||!userPassword) return alert("ì…ë ¥");

  userRef = db.ref("users/"+userId);
  userRef.once("value").then(s=>{
    if(!s.exists()){
      sword=1; power=10; gold=100;
      userRef.set({password:userPassword,sword,power,gold});
    } else {
      const d=s.val();
      if(d.password && d.password!==userPassword) return alert("ë¹„ë²ˆ ì˜¤ë¥˜");
      sword=d.sword??1; power=d.power??10; gold=d.gold??100;
    }
    loginScreen.style.display="none";
    gameScreen.style.display="block";
    update(); loadRanking();
  });
}

function save(){
  if(!userRef) return;
  userRef.update({sword,power,gold,updated:Date.now()});
  loadRanking();
}

/* ===============================
   ğŸ† ë­í‚¹
================================ */
function loadRanking(){
  db.ref("users").orderByChild("sword").limitToLast(10).once("value",s=>{
    let html="",arr=[];
    s.forEach(c=>arr.push({id:c.key,s:c.val().sword}));
    arr.reverse().forEach((u,i)=>{
      html+=`<div style="color:${getSwordColor(u.s)}">${i+1}. ${u.id} | +${u.s}ê°•</div>`;
    });
    ranking.innerHTML=html;
  });
}

/* ===============================
   ğŸ“œ ë¡œê·¸
================================ */
function writeLog(msg,isDestroy=false){
  logRef.push({message:msg,isDestroy,time:Date.now()});
}

logRef.limitToLast(50).on("child_added",s=>{
  const d=s.val();
  const t=document.createElement("div");
  t.className="toast-item";
  if(d.isDestroy) t.classList.add("toast-destroy");
  t.innerHTML=d.message;
  toastList.prepend(t);
  if(toastList.children.length>5) toastList.lastChild.remove();

  const p=document.createElement("div");
  p.innerHTML=d.message;
  if(d.isDestroy) p.style.color="red";
  logPanelList.prepend(p);
});

function toggleLog(){
  logPanel.style.display = logPanel.style.display==="none"?"block":"none";
}
</script>

</body>
</html>
