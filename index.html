<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ê²€ í‚¤ìš°ê¸°</title>
  <style>
    body {
      background: #111;
      color: white;
      text-align: center;
      font-family: Arial;
    }
    button {
      padding: 15px 30px;
      font-size: 18px;
      margin: 10px;
    }
  </style>
</head>
<body>

<h1>âš”ï¸ ê²€ í‚¤ìš°ê¸°</h1>

<p id="status"></p>

<hr>
<h2>ğŸ† ë­í‚¹ TOP 10</h2>
<div id="ranking">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  
<button onclick="upgrade()">ğŸ”¨ ê°•í™”</button>
<button onclick="hunt()">âš”ï¸ ì‚¬ëƒ¥</button>

<script>
  let sword = 1;
  let power = 10;
  let gold = 100;

  function update() {
    document.getElementById("status").innerHTML =
      `ê²€ ë ˆë²¨: ${sword}<br>
       ê³µê²©ë ¥: ${power}<br>
       ê³¨ë“œ: ${gold}`;
  }

  function upgrade() {
    if (gold < 20) {
      alert("ê³¨ë“œ ë¶€ì¡±!");
      return;
    }

    gold -= 20;

    if (Math.random() < 0.7) {
      sword++;
      power += 5;
      alert("âœ¨ ê°•í™” ì„±ê³µ!");
    } else {
      alert("ğŸ’¥ ê°•í™” ì‹¤íŒ¨");
    }
    update();
    save();
  }

  function hunt() {
    const earn = Math.floor(Math.random() * power);
    gold += earn;
    alert(`ì‚¬ëƒ¥ ì„±ê³µ! ê³¨ë“œ +${earn}`);
    update();
    save();
  }

  update();
</script>
<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyC-KjkMnJzN-fOBgg4P4sUo4U_VyhJTOn0",
    authDomain: "sword-game-1d1a1.firebaseapp.com",
    databaseURL: "https://sword-game-1d1a1-default-rtdb.firebaseio.com",
    projectId: "sword-game-1d1a1",
    storageBucket: "sword-game-1d1a1.firebasestorage.app",
    messagingSenderId: "595986310730",
    appId: "1:595986310730:web:d794cb2b6daa75125f68b3"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // ğŸ”‘ ìœ ì € ì½”ë“œ
  let userCode = prompt("ë‹¹ì‹ ì˜ ì½”ë“œ ì…ë ¥ (PC/ëª¨ë°”ì¼ ê³µí†µ)");

if (!userCode) {
  alert("ì½”ë“œë¥¼ ì…ë ¥í•´ì•¼ ê²Œì„ì„ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
  location.reload();
}


  const userRef = db.ref("users/" + userCode);

  // ğŸ”„ ë¶ˆëŸ¬ì˜¤ê¸°
  userRef.once("value").then(snapshot => {
    if (snapshot.exists()) {
      const data = snapshot.val();
      sword = data.sword ?? sword;
      power = data.power ?? power;
      gold = data.gold ?? gold;
      update();
    }
  });

  // ğŸ’¾ ì €ì¥ í•¨ìˆ˜
  function save() {
    userRef.set({
      sword,
      power,
      gold,
      updated: Date.now()
    });

    loadRanking();

  }
</script>
<script>
  function loadRanking() {
    db.ref("users")
      .orderByChild("power")
      .limitToLast(10)
      .once("value", snapshot => {
        let list = [];
        snapshot.forEach(child => {
          list.push({
            code: child.key,
            ...child.val()
          });
        });

        // ê³µê²©ë ¥ ë†’ì€ ìˆœ ì •ë ¬
        list.reverse();

        let html = "";
        list.forEach((u, i) => {
          html += `${i + 1}. ${u.code} | âš”ï¸ ${u.power}<br>`;
        });

        document.getElementById("ranking").innerHTML = html;
      });
  }

  loadRanking();
</script>

</body>
</html>
