<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ê²€ í‚¤ìš°ê¸°</title>
  <style>
    body {
      background: #111;
      color: white;
      text-align: center;
      font-family: Arial;
    }
    button {
      padding: 15px 30px;
      font-size: 18px;
      margin: 10px;
    }
  </style>
</head>
<body>

<h1>âš”ï¸ ê²€ í‚¤ìš°ê¸°</h1>

<p id="status"></p>

<hr>
<h2>ğŸ† ë­í‚¹ TOP 10</h2>
<div id="ranking">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  
<button onclick="upgrade()">ğŸ”¨ ê°•í™”</button>
<button onclick="hunt()">âš”ï¸ ì‚¬ëƒ¥</button>

<script>
  let sword = 1;
  let power = 10;
  let gold = 100;

  function update() {
    document.getElementById("status").innerHTML =
      `ê²€ ë ˆë²¨: ${sword}<br>
       ê³µê²©ë ¥: ${power}<br>
       ê³¨ë“œ: ${gold}`;
  }
function getUpgradeChance(level) {
  let chance = 90;

  if (level <= 10) {
    chance -= (level - 1) * 4;
  } else {
    chance -= 9 * 4;              // 1~10ê°• ê°ì†ŒëŸ‰
    chance -= (level - 10) * 3;   // 11ê°• ì´í›„ ê°ì†Œ
  }

  // ìµœì†Œ í™•ë¥  5%
  if (chance < 5) chance = 5;

  return chance;
}

function upgrade() {
  if (sword >= 30) {
    alert("âš ï¸ ì´ë¯¸ ìµœëŒ€ ê°•í™”ì…ë‹ˆë‹¤!");
    return;
  }

  if (gold < 20) {
    alert("ê³¨ë“œ ë¶€ì¡±!");
    return;
  }

  gold -= 20;

  const chance = getUpgradeChance(sword);

  // âœ… ê°•í™” ì„±ê³µ
  if (Math.random() < chance / 100) {
    sword++;
    power += 5;
    alert(`âœ¨ ê°•í™” ì„±ê³µ! (${sword}ê°•)`);
  }
  // âŒ ê°•í™” ì‹¤íŒ¨
  else {
    // ğŸ”° 1~10ê°• : ìœ ì§€
    if (sword <= 10) {
      alert("ğŸ’¥ ê°•í™” ì‹¤íŒ¨â€¦ í•˜ì§€ë§Œ ìœ ì§€!");
    }

    // ğŸŸ¡ 11~20ê°• : ìœ ì§€ / ê°•ë“±
    else if (sword <= 20) {
      if (Math.random() < 0.5) {
        alert("ğŸ’¥ ê°•í™” ì‹¤íŒ¨â€¦ í•˜ì§€ë§Œ ìœ ì§€!");
      } else {
        sword--;
        power -= 5;
        alert("ğŸ’¥ ê°•í™” ì‹¤íŒ¨! âœ ë‹¨ê³„ í•˜ë½ (-1)");
      }
    }

    // ğŸ”´ 21~30ê°• : ê°•ë“± / íŒŒê´´ (ìœ ì§€ ì—†ìŒ)
    else {
      if (Math.random() < 0.4) {
        sword--;
        power -= 5;
        alert("â˜ ï¸ ê°•í™” ì‹¤íŒ¨! âœ ë‹¨ê³„ í•˜ë½ (-1)");
      } else {
        sword = 1;
        power = 10;
        alert("ğŸ’£ ê²€ì´ íŒŒê´´ë˜ì—ˆìŠµë‹ˆë‹¤â€¦ ì²˜ìŒë¶€í„° ë‹¤ì‹œ!");
      }
    }
  }

  update();
  save();
}


  function hunt() {
    const earn = Math.floor(Math.random() * power);
    gold += earn;
    alert(`ì‚¬ëƒ¥ ì„±ê³µ! ê³¨ë“œ +${earn}`);
    update();
    save();
  }

  update();
</script>
<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyC-KjkMnJzN-fOBgg4P4sUo4U_VyhJTOn0",
    authDomain: "sword-game-1d1a1.firebaseapp.com",
    databaseURL: "https://sword-game-1d1a1-default-rtdb.firebaseio.com",
    projectId: "sword-game-1d1a1",
    storageBucket: "sword-game-1d1a1.firebasestorage.app",
    messagingSenderId: "595986310730",
    appId: "1:595986310730:web:d794cb2b6daa75125f68b3"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // ğŸ”‘ ìœ ì € ì½”ë“œ
  let userCode = prompt("ë‹¹ì‹ ì˜ ì½”ë“œ ì…ë ¥ (PC/ëª¨ë°”ì¼ ê³µí†µ)");
if (!userCode) {
  alert("ì½”ë“œë¥¼ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.");
  location.reload();
}

let userPassword = prompt("ë¹„ë°€ë²ˆí˜¸ ì…ë ¥");
if (!userPassword) {
  alert("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.");
  location.reload();
}


  const userRef = db.ref("users/" + userCode);

  // ğŸ”„ ë¶ˆëŸ¬ì˜¤ê¸°
userRef.once("value").then(snapshot => {
  if (!snapshot.exists()) {
    // ğŸ†• ì‹ ê·œ ìœ ì €
    if (!confirm("ì‹ ê·œ ê³„ì •ì…ë‹ˆë‹¤. ì´ ë¹„ë°€ë²ˆí˜¸ë¡œ ìƒì„±í• ê¹Œìš”?")) {
      location.reload();
      return;
    }

    userRef.set({
      password: userPassword,
      sword,
      power,
      gold,
      created: Date.now()
    });

    alert("ê³„ì • ìƒì„± ì™„ë£Œ!");
    update();
    loadRanking();
  } else {
    // ğŸ” ê¸°ì¡´ ìœ ì €
    const data = snapshot.val();

    if (data.password !== userPassword) {
      alert("âŒ ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
      location.reload();
      return;
    }

    sword = data.sword;
    power = data.power;
    gold = data.gold;

    alert("ë¡œê·¸ì¸ ì„±ê³µ!");
    update();
    loadRanking();
  }
});


  // ğŸ’¾ ì €ì¥ í•¨ìˆ˜
function save() {
  userRef.set({
    password: userPassword, // ğŸ” ìœ ì§€
    sword,
    power,
    gold,
    updated: Date.now()
  });

  loadRanking();
}

</script>
<script>
  function loadRanking() {
    db.ref("users")
      .orderByChild("power")
      .limitToLast(10)
      .once("value", snapshot => {
        let list = [];
        snapshot.forEach(child => {
          list.push({
            code: child.key,
            ...child.val()
          });
        });

        // ê³µê²©ë ¥ ë†’ì€ ìˆœ ì •ë ¬
        list.reverse();

        let html = "";
        list.forEach((u, i) => {
          html += `${i + 1}. ${u.code} | âš”ï¸ ${u.power}<br>`;
        });

        document.getElementById("ranking").innerHTML = html;
      });
  }

  loadRanking();
</script>

</body>
</html>
