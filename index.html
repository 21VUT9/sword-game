<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ê²€ í‚¤ìš°ê¸°</title>

<style>
body{
  background:#111;
  color:white;
  text-align:center;
  font-family:Arial;
  margin:0;
}

/* ë¡œê·¸ì¸ */
#loginScreen{
  max-width:360px;
  margin:120px auto;
  padding:20px;
  border:1px solid #444;
  background:#000;
}
#loginScreen input{
  width:90%;
  padding:10px;
  margin:6px 0;
}

/* ë²„íŠ¼ */
button{
  padding:12px 26px;
  font-size:18px;
  margin:8px;
  cursor:pointer;
}

/* ìƒíƒœ */
#status,#upgradeInfo{
  max-width:360px;
  margin:10px auto;
  padding:12px;
  border:1px solid #444;
  background:#000;
}

/* ë¬´ì§€ê°œ */
.rainbow{
  background:linear-gradient(90deg,red,orange,yellow,green,cyan,blue,violet);
  background-size:400% 400%;
  -webkit-background-clip:text;
  color:transparent;
  animation:rb 2s linear infinite;
}
@keyframes rb{from{background-position:0%}to{background-position:100%}}

/* ë¡œê·¸ */
#toastLog{
  position:fixed;
  bottom:10px;
  left:50%;
  transform:translateX(-50%);
  width:90%;
  max-width:600px;
  background:rgba(0,0,0,.8);
  border:1px solid #444;
  padding:6px;
}
.toast-item{border-bottom:1px solid #333;padding:4px}
.toast-destroy{color:red;font-weight:bold}

#logToggle{position:fixed;right:10px;bottom:80px}
#logPanel{
  position:fixed;
  top:60px;
  right:10px;
  width:90%;
  max-width:420px;
  height:60%;
  background:#000;
  border:1px solid #555;
  overflow-y:auto;
  display:none;
  padding:10px;
}
</style>
</head>

<body>

<!-- ë¡œê·¸ì¸ -->
<div id="loginScreen">
  <h2>ğŸ” ë¡œê·¸ì¸</h2>
  <input id="loginId" placeholder="ì•„ì´ë””">
  <input id="loginPw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
  <br>
  <button onclick="login()">ì ‘ì†</button>
</div>

<!-- ê²Œì„ -->
<div id="gameScreen" style="display:none">
  <h1>âš”ï¸ ê²€ í‚¤ìš°ê¸°</h1>
  <div id="status"></div>
  <div id="upgradeInfo"></div>

  <button onclick="upgrade()">ğŸ”¨ ê°•í™”</button>
  <button onclick="hunt()">âš”ï¸ ì‚¬ëƒ¥</button>

  <hr>
  <h2>ğŸ† ë­í‚¹ TOP 10</h2>
  <div id="ranking">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
</div>

<div id="toastLog"><div id="toastList"></div></div>
<button id="logToggle" onclick="toggleLog()">ğŸ“œ ë¡œê·¸</button>
<div id="logPanel"><h3>ê°•í™” ë¡œê·¸</h3><div id="logPanelList"></div></div>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyC-KjkMnJzN-fOBgg4P4sUo4U_VyhJTOn0",
  databaseURL:"https://sword-game-1d1a1-default-rtdb.firebaseio.com"
});
const db=firebase.database();
const logRef=db.ref("logs");

let sword=1,power=10,gold=100;
let userId="",userRef=null;

/* ìƒ‰ìƒ */
function getSwordColor(l){
  if(l>=30)return"rainbow";
  if(l>=25)return"gold";
  if(l>=20)return"red";
  if(l>=15)return"yellow";
  if(l>=10)return"lime";
  return"white";
}
function coloredLevel(l){
  if(l>=30)return `<span class="rainbow">+${l}ê°•</span>`;
  return `<span style="color:${getSwordColor(l)}">+${l}ê°•</span>`;
}

/* í™•ë¥  */
function getChance(){
  if(sword<10)return 80;
  if(sword<20)return 40;
  if(sword<25)return 20;
  return 5;
}

/* UI */
function update(){
  status.innerHTML=`
    ğŸ”° ê°•í™”: <b>+${sword}</b><br>
    âš”ï¸ ê³µê²©ë ¥: <b>${power}</b><br>
    ğŸ’° ê³¨ë“œ: <b>${gold}</b>
  `;
  upgradeInfo.innerHTML=`ì„±ê³µí™•ë¥  ${getChance()}% / í•„ìš” ê³¨ë“œ 20`;
}

/* ë¡œê·¸ì¸ */
function login(){
  userId=loginId.value.trim();
  const pw=loginPw.value;
  if(!userId||!pw)return alert("ì…ë ¥ í•„ìš”");

  userRef=db.ref("users/"+userId);
  userRef.once("value").then(s=>{
    if(!s.exists()){
      userRef.set({password:pw,sword,power,gold});
    }else{
      if(s.val().password!==pw)return alert("ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜");
      sword=s.val().sword; power=s.val().power; gold=s.val().gold;
    }
    loginScreen.style.display="none";
    gameScreen.style.display="block";
    update(); loadRanking();
  });
}

/* ê°•í™” */
function upgrade(){
  if(gold<20)return alert("ê³¨ë“œ ë¶€ì¡±");
  gold-=20;
  const before=sword;

  if(Math.random()<getChance()/100){
    sword++; power+=5;
    if(before>=21) writeLog(`${userId} ${coloredLevel(before)} â†’ ${coloredLevel(sword)} ì„±ê³µ`);
  }else{
    if(sword<=10){}
    else if(sword<=20){sword--;power-=5;}
    else{
      if(Math.random()<0.5){sword--;power-=5;}
      else{
        sword=1;power=10;
        writeLog(`${userId} ${coloredLevel(before)} ë„ì „ ì¤‘ íŒŒê´´!`,true);
      }
    }
  }
  save(); update(); loadRanking();
}

/* ì‚¬ëƒ¥ */
function hunt(){
  const earn=Math.floor(Math.random()*power);
  gold+=earn;
  alert(`ê³¨ë“œ +${earn}`);
  save(); update();
}

/* ì €ì¥ */
function save(){
  userRef.update({sword,power,gold,updated:Date.now()});
}

/* ë­í‚¹ */
function loadRanking(){
  db.ref("users").once("value").then(s=>{
    let arr=[];
    s.forEach(c=>arr.push({...c.val(),id:c.key}));
    arr.sort((a,b)=>b.sword-a.sword);
    ranking.innerHTML=arr.slice(0,10).map((u,i)=>`
      <div style="color:${getSwordColor(u.sword)}">
        ${i+1}. ${u.id} | +${u.sword}ê°• | ğŸ’° ${u.gold}
      </div>
    `).join("");
  });
}

/* ë¡œê·¸ */
function writeLog(msg,destroy=false){
  logRef.push({msg,destroy,time:Date.now()});
}
logRef.limitToLast(5).on("child_added",s=>{
  const d=s.val();
  const line=document.createElement("div");
  line.className="toast-item"+(d.destroy?" toast-destroy":"");
  line.innerHTML=`[${new Date(d.time).toLocaleTimeString()}] ${d.msg}`;
  toastList.prepend(line);
  while(toastList.children.length>5)toastList.lastChild.remove();

  const p=line.cloneNode(true);
  logPanelList.prepend(p);
  while(logPanelList.children.length>5)logPanelList.lastChild.remove();
});

/* ë¡œê·¸ íŒ¨ë„ */
function toggleLog(){
  logPanel.style.display=logPanel.style.display==="none"?"block":"none";
}
</script>
</body>
</html>
