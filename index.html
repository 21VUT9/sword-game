<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ê²€ í‚¤ìš°ê¸°</title>

<style>
body {
  background:#111;
  color:white;
  text-align:center;
  font-family:Arial;
}

/* ë²„íŠ¼ */
button {
  padding:15px 30px;
  font-size:18px;
  margin:10px;
}

/* ğŸŒˆ 30ê°• ë¬´ì§€ê°œ */
.rainbow {
  background:linear-gradient(90deg,red,orange,yellow,green,cyan,blue,violet);
  background-size:400% 400%;
  -webkit-background-clip:text;
  color:transparent;
  animation:rainbow 2s linear infinite;
  display:inline-block;
}
@keyframes rainbow {
  from {background-position:0%}
  to {background-position:100%}
}
  /* âœ¨ ì‹¤ë²„ / ê³¨ë“œ ë°˜ì§ì„ */
.sparkle-silver {
  color: #C0C0C0;
  font-weight: bold;
  text-shadow: 0 0 5px rgba(192,192,192,0.8);
  animation: sparkle 1.5s infinite alternate;
}

.sparkle-gold {
  color: #FFD700;
  font-weight: bold;
  text-shadow: 0 0 8px rgba(255,215,0,0.9);
  animation: sparkle 1.2s infinite alternate;
}

/* âœ¨ ê³µí†µ ë°˜ì§ ì• ë‹ˆë©”ì´ì…˜ */
@keyframes sparkle {
  from {
    opacity: 0.85;
    filter: brightness(1);
  }
  to {
    opacity: 1;
    filter: brightness(1.4);
  }
}


/* ğŸ”” í† ìŠ¤íŠ¸ */
#toastLog {
  position:fixed;
  bottom:10px;
  left:50%;
  transform:translateX(-50%);
  width:90%;
  max-width:600px;
  background:rgba(0,0,0,0.75);
  border:1px solid #444;
  padding:8px;
  font-size:14px;
  z-index:1000;
}
.toast-item {
  padding:4px 0;
  border-bottom:1px solid #333;
}
.toast-destroy {
  color:red;
  font-weight:bold;
}

/* ë¡œê·¸ */
#logToggle {
  position:fixed;
  bottom:80px;
  right:10px;
  z-index:1001;
}
#logPanel {
  position:fixed;
  top:60px;
  right:10px;
  width:90%;
  max-width:400px;
  height:60%;
  background:rgba(0,0,0,0.9);
  border:1px solid #555;
  padding:10px;
  overflow-y:auto;
  z-index:1002;
  display:none;
}
</style>
</head>

<body>

<!-- ğŸ” ë¡œê·¸ì¸ -->
<div id="loginScreen">
  <h2>ğŸ” ë¡œê·¸ì¸</h2>
  <input id="loginId" placeholder="ì•„ì´ë””"><br><br>
  <input id="loginPw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸"><br><br>
  <button onclick="login()">ì ‘ì†</button>
</div>

<!-- ğŸ® ê²Œì„ -->
<div id="gameScreen" style="display:none;">
  <h1>âš”ï¸ ê²€ í‚¤ìš°ê¸°</h1>
  <p id="status"></p>

  <button onclick="upgrade()">ğŸ”¨ ê°•í™”</button>
  <button onclick="hunt()">âš”ï¸ ì‚¬ëƒ¥</button>

  <hr>
  <h2>ğŸ† ë­í‚¹ TOP 10</h2>
  <div id="ranking">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
</div>

<!-- ğŸ”” ë¡œê·¸ -->
<div id="toastLog"><div id="toastList"></div></div>
<button id="logToggle" onclick="toggleLog()">ğŸ“œ ë¡œê·¸</button>
<div id="logPanel">
  <h3>ğŸ“¢ ê°•í™” ë¡œê·¸</h3>
  <div id="logPanelList"></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

<script>
/* Firebase */
firebase.initializeApp({
  apiKey:"AIzaSyC-KjkMnJzN-fOBgg4P4sUo4U_VyhJTOn0",
  authDomain:"sword-game-1d1a1.firebaseapp.com",
  databaseURL:"https://sword-game-1d1a1-default-rtdb.firebaseio.com",
  projectId:"sword-game-1d1a1"
});
const db = firebase.database();
const logRef = db.ref("logs");

/* ìƒíƒœ */
let sword=1, power=10, gold=100;
let userId="", userPassword="", userRef=null;

/* UI */
function update(){
  document.getElementById("status").innerHTML = `
    <div style="font-size:18px;">
      ğŸ”° í˜„ì¬ ê°•í™” : <b>+${sword}ê°•</b><br>
      âš”ï¸ ê³µê²©ë ¥ : <b>${power}</b><br>
      ğŸ’° ê³¨ë“œ : <b>${gold}</b>
    </div>
  `;
}

/* í™•ë¥  */
function getUpgradeChance(level){
  if(level<10) return 80;
  if(level<20) return 40;
  if(level<25) return 20;
  return 5;
}

/* ê°•í™” */
function upgrade(){
  if(sword>=30){alert("ìµœëŒ€ ê°•í™”");return;}
  if(gold<20){alert("ê³¨ë“œ ë¶€ì¡±");return;}
  gold-=20;

  const chance=getUpgradeChance(sword);
  const before=sword;

  if(Math.random()<chance/100){
    sword++; power+=5;
    alert("ê°•í™” ì„±ê³µ!");
    if(before>=20){
      writeLog(`${userId}ì´ ${coloredLevel(before)} ë„ì „ì— ì„±ê³µí•˜ì—¬ ${coloredLevel(sword)}ì´ ë˜ì—ˆìŠµë‹ˆë‹¤!`);
    }
  }else{
    if(sword<=10){
      alert("ì‹¤íŒ¨ (ìœ ì§€)");
    }else if(sword<=20){
      if(Math.random()<0.5) alert("ì‹¤íŒ¨ (ìœ ì§€)");
      else{ sword--; power-=5; alert("ê°•ë“±"); }
    }else{
      if(Math.random()<0.4){
        sword--; power-=5; alert("ê°•ë“±");
      }else{
        sword=1; power=10;
        writeLog(`${userId}ì´ ${coloredLevel(before)} ë„ì „ì— ì‹¤íŒ¨í•˜ì—¬ <span style="color:red;font-weight:bold;">íŒŒê´´</span> ë˜ì—ˆìŠµë‹ˆë‹¤!`,true);
        alert("íŒŒê´´");
      }
    }
  }
  update(); save();
}

/* ì‚¬ëƒ¥ */
function hunt(){
  const earn=Math.floor(Math.random()*power);
  gold+=earn;
  alert(`ê³¨ë“œ +${earn}`);
  update(); save();
}

/* ë¡œê·¸ì¸ */
function login(){
  userId=loginId.value.trim();
  userPassword=loginPw.value;
  if(!userId||!userPassword){alert("ì…ë ¥ í•„ìš”");return;}

  userRef=db.ref("users/"+userId);
  userRef.once("value").then(s=>{
    if(!s.exists()){
      userRef.set({password:userPassword,sword,power,gold});
    }else{
      if(s.val().password!==userPassword){alert("ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜");return;}
      sword=s.val().sword; power=s.val().power; gold=s.val().gold;
    }
    loginScreen.style.display="none";
    gameScreen.style.display="block";
    update(); 
  });
}

/* ì €ì¥ */
function save(){
  if(!userRef) return;
userRef.update({
  sword: Number(sword),
  power: Number(power),
  gold: Number(gold),
  updated: Date.now()
});

}

/* ìƒ‰ìƒ */
function getSwordColor(l){
  if (l >= 30) return "rainbow";
  if (l === 29) return "sparkle-gold";
  if (l === 28) return "sparkle-silver";

  const colorMap = {
    21: "red",
    22: "yellow",
    23: "lime",
    24: "cyan",
    25: "violet",
    26: "brown",
    27: "pink"
  };

  if (l >= 21) return colorMap[l] || "white";
  if (l >= 11) return "lime";
  return "white";
}

function coloredLevel(l){
  // ğŸŒˆ 30ê°•
  if (l >= 30) {
    return `<span class="rainbow">+${l}ê°•</span>`;
  }

  // âœ¨ 29 / 28 ë°˜ì§
  if (l === 29) {
    return `<span class="sparkle-gold">+${l}ê°•</span>`;
  }
  if (l === 28) {
    return `<span class="sparkle-silver">+${l}ê°•</span>`;
  }

  // ğŸ¨ 21~27 ê°œë³„ ìƒ‰ìƒ
  const colorMap = {
    21: "red",
    22: "yellow",
    23: "lime",
    24: "cyan",
    25: "violet",
    26: "brown",
    27: "pink"
  };

  if (l >= 21) {
    return `<span style="color:${colorMap[l]};font-weight:bold;">+${l}ê°•</span>`;
  }

  // ğŸ‘‰ 11~20ì€ ìƒ‰ ì—†ìŒ (ê¸°ë³¸ í°ìƒ‰)
  return `+${l}ê°•`;
}



/* ë­í‚¹ */
function loadRanking(){
  db.ref("users")
    .orderByChild("sword")
    .limitToLast(10)
    .on("value", s=>{
      let arr=[];
      s.forEach(c=>{
        const d=c.val();
        arr.push({
          id: c.key,
          sword: Number(d.sword || 0)
        });
      });
      arr.sort((a,b)=>b.sword-a.sword);

      ranking.innerHTML = arr.map((u,i)=>{

return `
  <div style="font-weight:bold;">
    ${i+1}. ${u.id} | ${coloredLevel(u.sword)}
  </div>
`;

}).join("");

    });
}




/* ë¡œê·¸ */
function writeLog(message,isDestroy=false){
  logRef.push({message,isDestroy,time:Date.now()});
}
logRef.limitToLast(50).on("child_added",s=>{
  const d=s.val();
  const el=document.createElement("div");
  el.className="toast-item"+(d.isDestroy?" toast-destroy":"");
  el.innerHTML=d.message;
  toastList.prepend(el);
  while(toastList.children.length>5) toastList.lastChild.remove();

  const p=el.cloneNode(true);
  logPanelList.prepend(p);
});

/* ë¡œê·¸ í† ê¸€ */
function toggleLog(){
  logPanel.style.display = logPanel.style.display==="none"?"block":"none";
}
  
  loadRanking();
</script>

</body>
</html>
