<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ê²€ í‚¤ìš°ê¸°</title>
  <style>
    body {
      background: #111;
      color: white;
      text-align: center;
      font-family: Arial;
    }

    button {
      padding: 15px 30px;
      font-size: 18px;
      margin: 10px;
    }

    /* ğŸŒˆ 30ê°• ë¬´ì§€ê°œ íš¨ê³¼ */
.rainbow {
  background: linear-gradient(
    90deg,
    red, orange, yellow, green, cyan, blue, violet
  );
  background-size: 400% 400%;   /* â­ ì¶”ê°€ */
  -webkit-background-clip: text;
  color: transparent;
  animation: rainbow 2s linear infinite;
  display: inline-block;        /* â­ ì¶”ê°€ */
}


    @keyframes rainbow {
      from { background-position: 0% }
      to { background-position: 100% }
    }

  /* ğŸ”” í•˜ë‹¨ í† ìŠ¤íŠ¸ */
#toastLog {
  position: fixed;
  bottom: 10px;
  left: 50%;
  transform: translateX(-50%);
  width: 90%;
  max-width: 600px;
  background: rgba(0,0,0,0.75);
  border: 1px solid #444;
  padding: 8px;
  font-size: 14px;
  z-index: 1000;
}

.toast-item {
  padding: 4px 0;
  border-bottom: 1px solid #333;
}

/* ğŸ”´ íŒŒê´´ ê°•ì¡° */
.toast-destroy {
  color: red;
  font-weight: bold;
}

/* ğŸ“œ ë¡œê·¸ ë²„íŠ¼ */
#logToggle {
  position: fixed;
  bottom: 80px;
  right: 10px;
  z-index: 1001;
}

/* ğŸ“œ ì „ì²´ ë¡œê·¸ íŒ¨ë„ */
#logPanel {
  position: fixed;
  top: 60px;
  right: 10px;
  width: 90%;
  max-width: 400px;
  height: 60%;
  background: rgba(0,0,0,0.9);
  border: 1px solid #555;
  padding: 10px;
  overflow-y: auto;
  z-index: 1002;
}

#logPanel h3 {
  margin-top: 0;
  border-bottom: 1px solid #555;
}

  </style>
</head>

<body>
<!-- ğŸ” ë¡œê·¸ì¸ í™”ë©´ -->
<div id="loginScreen">
  <h2>ğŸ” ë¡œê·¸ì¸</h2>

  <input id="loginId" placeholder="ì•„ì´ë””" /><br><br>
  <input id="loginPw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸" /><br><br>

  <button onclick="login()">ì ‘ì†</button>
</div>

<!-- ğŸ® ê²Œì„ í™”ë©´ -->
<div id="gameScreen" style="display:none;">
  <!-- ğŸ‘‡ ê¸°ì¡´ ê²Œì„ ë‚´ìš© ì „ë¶€ ì´ ì•ˆìœ¼ë¡œ ì´ë™ -->

<h1>âš”ï¸ ê²€ í‚¤ìš°ê¸°</h1>

<p id="status"></p>

<hr>
<h2>ğŸ† ë­í‚¹ TOP 10</h2>
<div id="ranking">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  
<button onclick="upgrade()">ğŸ”¨ ê°•í™”</button>
<button onclick="hunt()">âš”ï¸ ì‚¬ëƒ¥</button>

<script>
  let sword = 1;
  let power = 10;
  let gold = 100;

  <script>
function update() {
  document.getElementById("status").innerHTML = `
    <div style="font-size:18px; margin:10px 0;">
      ğŸ”° í˜„ì¬ ê°•í™” : <b>+${sword}ê°•</b><br>
      âš”ï¸ ê³µê²©ë ¥ : <b>${power}</b><br>
      ğŸ’° ê³¨ë“œ : <b>${gold}</b>
    </div>
  `;
}
</script>


function upgrade() {
  if (sword >= 30) {
    alert("âš ï¸ ì´ë¯¸ ìµœëŒ€ ê°•í™”ì…ë‹ˆë‹¤!");
    return;
  }

  if (gold < 20) {
    alert("ê³¨ë“œ ë¶€ì¡±!");
    return;
  }

  gold -= 20;

  const chance = getUpgradeChance(sword);

  // âœ… ê°•í™” ì„±ê³µ
  if (Math.random() < chance / 100) {
    const before = sword;
    sword++;
    power += 5;

    alert(`âœ¨ ê°•í™” ì„±ê³µ! (${sword}ê°•)`);

    // ğŸ”” 20ê°• ì´ìƒ ì„±ê³µ ë¡œê·¸
    if (before >= 20) {
writeLog(
  `${userId}ì´ ${coloredLevel(before)} ë„ì „ì— ì„±ê³µí•˜ì—¬ ${coloredLevel(sword)}ì´ ë˜ì—ˆìŠµë‹ˆë‹¤!`
);

    }
  }
  // âŒ ê°•í™” ì‹¤íŒ¨
  else {
    // ğŸ”° 1~10ê°• : ìœ ì§€
    if (sword <= 10) {
      alert("ğŸ’¥ ê°•í™” ì‹¤íŒ¨â€¦ í•˜ì§€ë§Œ ìœ ì§€!");
    }

    // ğŸŸ¡ 11~20ê°• : ìœ ì§€ / ê°•ë“±
    else if (sword <= 20) {
      if (Math.random() < 0.5) {
        alert("ğŸ’¥ ê°•í™” ì‹¤íŒ¨â€¦ í•˜ì§€ë§Œ ìœ ì§€!");
      } else {
        sword--;
        power -= 5;
        alert("ğŸ’¥ ê°•í™” ì‹¤íŒ¨! âœ ë‹¨ê³„ í•˜ë½ (-1)");
      }
    }

    // ğŸ”´ 21~30ê°• : ê°•ë“± / íŒŒê´´
    else {
      if (Math.random() < 0.4) {
        sword--;
        power -= 5;
        alert("â˜ ï¸ ê°•í™” ì‹¤íŒ¨! âœ ë‹¨ê³„ í•˜ë½ (-1)");
      } else {
        const before = sword;
        sword = 1;
        power = 10;

        alert("ğŸ’£ ê²€ì´ íŒŒê´´ë˜ì—ˆìŠµë‹ˆë‹¤â€¦ ì²˜ìŒë¶€í„° ë‹¤ì‹œ!");

        // ğŸ”´ íŒŒê´´ ë¡œê·¸
writeLog(
  `${userId}ì´ ${coloredLevel(before)} ë„ì „ì— ì‹¤íŒ¨í•˜ì—¬ <span style="color:red; font-weight:bold;">íŒŒê´´</span> ë˜ì—ˆìŠµë‹ˆë‹¤!`,
  true
);

      }
    }
  }

  update();
  save();
}



  function hunt() {
    const earn = Math.floor(Math.random() * power);
    gold += earn;
    alert(`ì‚¬ëƒ¥ ì„±ê³µ! ê³¨ë“œ +${earn}`);
    update();
    save();
  }

  update();
</script>
<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyC-KjkMnJzN-fOBgg4P4sUo4U_VyhJTOn0",
    authDomain: "sword-game-1d1a1.firebaseapp.com",
    databaseURL: "https://sword-game-1d1a1-default-rtdb.firebaseio.com",
    projectId: "sword-game-1d1a1",
    storageBucket: "sword-game-1d1a1.firebasestorage.app",
    messagingSenderId: "595986310730",
    appId: "1:595986310730:web:d794cb2b6daa75125f68b3"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const logRef = db.ref("logs");

  function writeLog(message, isDestroy = false) {
  logRef.push({
    message,
    isDestroy,
    time: Date.now()
  });
}


  // ğŸ”‘ ìœ ì € ì½”ë“œ

  let userId = "";
let userPassword = "";
let userRef = null;

<script>
function login() {
  userId = document.getElementById("loginId").value.trim();
  userPassword = document.getElementById("loginPw").value;

  if (!userId || !userPassword) {
    alert("ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
    return;
  }

  userRef = db.ref("users/" + userId);

  userRef.once("value").then(snapshot => {

    /* ğŸ†• ì‹ ê·œ ê³„ì • */
    if (!snapshot.exists()) {
      if (!confirm("ì‹ ê·œ ê³„ì •ì…ë‹ˆë‹¤. ìƒì„±í• ê¹Œìš”?")) return;

      sword = 1;
      power = 10;
      gold = 100;

      userRef.set({
        password: userPassword,
        sword,
        power,
        gold,
        created: Date.now()
      });

      alert("ê³„ì • ìƒì„± ì™„ë£Œ!");
    }

    /* ğŸ” ê¸°ì¡´ ê³„ì • */
    else {
      const data = snapshot.val();

      /* âš ï¸ ê³¼ê±° ê³„ì • (ë¹„ë°€ë²ˆí˜¸ ì—†ìŒ) */
      if (!data.password) {
        userRef.update({ password: userPassword });
      }
      /* âŒ ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜ */
      else if (data.password !== userPassword) {
        alert("âŒ ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
        return;
      }

      sword = data.sword ?? 1;
      power = data.power ?? 10;
      gold = data.gold ?? 100;

      alert("ë¡œê·¸ì¸ ì„±ê³µ!");
    }

    document.getElementById("loginScreen").style.display = "none";
    document.getElementById("gameScreen").style.display = "block";

    update();
    loadRanking();
  });
}
</script>




// ğŸ’¾ ì €ì¥ í•¨ìˆ˜
function save() {
  if (!userRef) return;   // ğŸ”’ ë¡œê·¸ì¸ ì „ ì €ì¥ ë°©ì§€

userRef.update({
  sword,
  power,
  gold,
  updated: Date.now()
});


  loadRanking();
}


</script>
<script>
function getSwordColor(level) {
  if (level >= 30) return "rainbow";
  if (level === 29) return "gold";
  if (level === 28) return "silver";
  if (level === 27) return "hotpink";
  if (level === 26) return "brown";
  if (level === 25) return "purple";
  if (level === 24) return "dodgerblue";
  if (level === 23) return "limegreen";
  if (level === 22) return "yellow";
  if (level === 21) return "red";
  return "white";
}

function coloredLevel(level) {
  const color = getSwordColor(level);

  // 30ê°•ì€ rainbow í´ë˜ìŠ¤
  if (level >= 30) {
    return `<span class="rainbow">+${level}ê°•</span>`;
  }

  return `<span style="color:${color}; font-weight:bold;">+${level}ê°•</span>`;
}

  
function loadRanking() {
  db.ref("users")
    .orderByChild("sword")   // âœ… ê°•í™” ë‹¨ê³„ ê¸°ì¤€
    .limitToLast(10)
    .once("value", snapshot => {
      let list = [];

      snapshot.forEach(child => {
        list.push({
          code: child.key,
          sword: child.val().sword
        });
      });

      // ë†’ì€ ê°•í™”ë¶€í„°
      list.reverse();

let html = "";

list.forEach((u, i) => {
  if (u.sword >= 30) {
    html += `
      <div class="rainbow" style="font-weight:bold;">
        ${i + 1}. ${u.code} | +${u.sword}ê°•
      </div>
    `;
  } else {
    const color = getSwordColor(u.sword);
    html += `
      <div style="color:${color}; font-weight:bold;">
        ${i + 1}. ${u.code} | +${u.sword}ê°•
      </div>
    `;
  }
});

document.getElementById("ranking").innerHTML = html;

    });
}


  loadRanking();
</script>
<!-- ğŸ”” í•˜ë‹¨ ì‹¤ì‹œê°„ ë¡œê·¸ (í† ìŠ¤íŠ¸) -->
<div id="toastLog">
  <div id="toastList"></div>
</div>

<!-- ğŸ“œ ì „ì²´ ë¡œê·¸ ë³´ê¸° ë²„íŠ¼ -->
<button id="logToggle" onclick="toggleLog()">ğŸ“œ ë¡œê·¸</button>

<!-- ğŸ“œ ì „ì²´ ë¡œê·¸ íŒ¨ë„ -->
<div id="logPanel" style="display:none;">
  <h3>ğŸ“¢ ê°•í™” ë¡œê·¸</h3>
  <div id="logPanelList"></div>
</div>
<script>
logRef
  .limitToLast(50)
  .on("child_added", snapshot => {
    const data = snapshot.val();

    /* ğŸ”” í† ìŠ¤íŠ¸ */
    const toast = document.createElement("div");
    toast.className = "toast-item";
toast.innerHTML = data.message;

    if (data.isDestroy) {
      toast.classList.add("toast-destroy");
    }

    const toastList = document.getElementById("toastList");
    toastList.prepend(toast);

    while (toastList.children.length > 5) {
      toastList.removeChild(toastList.lastChild);
    }

    /* ğŸ“œ íŒ¨ë„ */
    const panelItem = document.createElement("div");
panelItem.innerHTML = data.message;


    if (data.isDestroy) {
      panelItem.style.color = "red";
      panelItem.style.fontWeight = "bold";
    }

    document.getElementById("logPanelList").prepend(panelItem);
  });

function toggleLog() {
  const panel = document.getElementById("logPanel");
  panel.style.display = panel.style.display === "none" ? "block" : "none";
}
</script>

 </div> <!-- gameScreen ë -->

</body>
</html>
